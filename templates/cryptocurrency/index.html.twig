{% extends 'base.html.twig' %}

{% block title %}Coinyzer | Classements{% endblock %}

{% block body %}
    {% include "./components/nav.html.twig" %}

    <section class="h-100 d-flex flex-column justify-content-center text-center">
        <div class="container">
        <button type="button" class="btn btn-primary refresh">refresh</button>
            {% if app.user %}
                <ul class="nav nav-tabs">

                    <li class="nav-item">
                        <a class="nav-link rank active" aria-current="page" href="#">Classement</a>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link watchlist" href=" {{ path('app_cryptocurrenciesWatchlist')}} ">Favoris</a>
                    </li>
                </ul>
            {% endif %}

            <div class="table-responsive">
                {% include "./components/table_rank.html.twig" %}            	
            </div>
            <div class="pagination justify-content-center">
                {{ knp_pagination_render(cryptocurrencies, 'components/pagination.html.twig') }}
            </div>
        </div>
        <footer class="w-100 position-absolute bottom-0">
            <p><a href="#" class="text-decoration-none text-muted">Copyright © 2021 Coinyzer.fr - Tous droits réservés</a></p>
        </footer>
    </section>

{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="{{asset('js/getData.js')}} "></script>
    <script src=" {{asset('js/tableWatchlist.js')}} "></script>
    <script>
        let btn = document.querySelectorAll('.add-watchlist');

        btn.forEach(element => {
            element.addEventListener('click', function(e) {
                e.preventDefault();
                let url = this.href;
                
                fetch(url, {
                    method: "POST"
                })
                .then(function(response) {
                    if (response.status !== 200) {
                        return response.text().then(function(text) {

                            let value = JSON.parse(text);
                            console.log(value.message);
                        });
                        // alert('Connectez-vous');

                    } else if (response.status === 200) {
                        return response.text().then(function(text) {

                            let value = JSON.parse(text);
                            console.log(value.message);
                            let state = element.children[0].classList;

                            if (value.message === 'add' || value.message === 'create and add' ) {
                                state.replace("far", "fas");
                            } else if(value.message === 'remove') {
                                state.replace("fas", "far");
                            }
                        });
                    }
                })
            })
        }); 

    </script>

{% endblock %}

